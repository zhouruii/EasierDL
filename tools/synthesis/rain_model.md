## 高光谱图像加雨探索

### 基础建模

1. **加性模型**

> 最简单的雨天图像模型是将雨条的贡献直接叠加到场景图像中：
> 
> 
> $$
> I(x,y)=J(x,y)+R(x,y)
> 
> 
> 该模型假设雨条的亮度直接累加到背景图像中，但未考虑透明度和大气散射效应。
> 

1. **透明度模型**

> 为了更真实地描述雨条的效果，可以引入透明度（$\alpha$）因子：
> 
> 
> $$
> I(x, y) = (1 - \alpha(x, y)) J(x, y) + \alpha(x, y) R(x, y)
> $$
> 
> - $\alpha(x, y)$：雨条的透明度，通常取值在 [0, 1] 范围内。
1. **大气散射模型**

> 雨天图像还受到大气散射效应（如雾霾）的影响。结合大气散射模型，雨天图像可以建模为：
> 
> 
> $$
> I(x, y) = J(x, y) \cdot e^{-\beta d(x, y)} + A(1 - e^{-\beta d(x, y)}) + R(x, y)
> $$
> 
> - $\beta$：大气散射系数。
> - $d(x,y)$：从相机到场景物体的深度。
> - $A$：大气光强度。
> 
> 该模型将大气散射和雨条叠加考虑，更接近实际雨天的成像条件。
> 

---

### 高光谱域探索

散射系数$\beta$的**影响因子**：

1. 大气中颗粒物（如气溶胶、雾滴、雨滴）和气体的分布。
2. ⭐散射系数$\beta$关联于波段：成像时使用的波段（**波长**）
    - **瑞利散射**（Rayleigh Scattering）：当光线的波长远大于散射颗粒的尺寸（例如空气分子），散射强度与波长的关系满足 $\beta \propto \lambda^{-4}$。这表明波长越短（如蓝光，约 450 nm），散射越强；波长越长（如红光，约 700 nm），散射越弱。
    - **米散射**（Mie Scattering）：当颗粒物的尺寸接近光的波长（如雾滴或雨滴），散射特性更加复杂，通常不再简单地依赖于$\lambda^{-4}$，但仍受波长影响。短波长的光仍然比长波长光容易被散射。
    - **非选择性散射**：当颗粒尺寸远大于波长（例如大雾或大雨中的水滴），散射不明显依赖波长，而是均匀地影响所有波段。

---

对$\beta$进行建模：

$$
β(λ)=β_0⋅λ^{−k}
$$

- $\beta_0$：某基准波长下的散射系数。
- $k$：散射的波长依赖指数，取决于主要散射机制（瑞利散射时 $k \approx 4$，米散射时 k 更小且波段相关性更复杂）。

---

将波段关联到更多信息：

1. 关联到**透过率**$T(x,y,λ)$

$$
T(x,y,λ)=exp(−β(λ)d(x,y))
$$

其中：

- $\beta(\lambda)$：散射系数，依赖波长；
- $d(x,y$)：雨滴厚度或路径长度。
1. 关联到**大气光强$A(λ)$**：

$$
A(λ)=A_0(λ)⋅exp(−β_a(λ)h)
$$

其中：

- $A_0(\lambda)$：初始光谱强度；
- $\beta_a(\lambda)$：大气散射系数；
- $h$：大气厚度（光的传播距离）
  
    一般来讲，A取一个定值
    
1. 关联到**雨纹**$R_r(x,y,λ)$

$$
R_r(x,y,λ)=\sum_{i=1}^{N}a_i(λ)g(x,y;θ_i,σ_i)
$$

其中：

- $N$：雨滴数量；
- $a_i(\lambda)$：每个雨滴的纹理强度，可能与波长 $\lambda$ 相关；
- $g(x, y; \theta_i, \sigma_i)$：高斯型或条纹型的二维分布，描述雨滴的形状和分布；
    - $\theta_i$：雨滴的方向；
    - $\sigma_i$：雨滴的扩展程度（雨滴大小）。
    
    $a_i(\lambda)$的探索：
    
    考虑到水的吸收特性：随着波长的增加，水对光的吸收作用越强（这个变化也是非线性的）。
    
    - **可见光区域（400-700nm）**：水的吸收较小，通常可以认为是近似常数。
    - **近红外区域（700-1300nm）**：吸收作用相比于可见光波段显著增强，并且存在两个较为明显的吸收峰（如 980nm 和 1200nm）。
    - **中红外区域（1300-2500nm）**：水的吸收再次增加，吸收强度很高。
    
    可能的建模方式：
    
    $$
    a_i(\lambda)=\left\{\begin{array}{rcl}0.0001       &      & {\lambda  \in [400,700]}\\0.001exp({\dfrac{\lambda-700}{200}})     &      & {\lambda  \in [700,1300]}\\0.01exp({\dfrac{\lambda-1300}{300}})     &      & {\lambda  \in [1300,2500]}\end{array} \right. 
    $$
    

$$
a_i(\lambda)=\left\{\begin{array}{rcl}A_1 \times (\frac {\lambda} {\lambda_0})^{n_1}       &      & {\lambda  \in [400,980]}\\A_2 \times (\frac {\lambda} {\lambda_0})^{n_2}     &      & {\lambda  \in [980,1200]}\\A_3 \times (\frac {\lambda} {\lambda_0})^{n_3}     &      & {\lambda  \in [1200,2500]}\end{array} \right. 
$$

---

### 数学模型

$$
O(x, y, \lambda) = I_R(x, y, \lambda) + I_F(x,y,\lambda) - I(x,y,\lambda)
$$

其中分为雨纹与雨雾：

> **雨纹信息**：
> 
> 
> $$
> I_R(x, y, \lambda) = I(x, y, \lambda)\cdot(1-R(x, y, \lambda)) + 
> R_0 \cdot R(x, y, \lambda)
> $$
> 
> 其中：
> 
> $$
> R(x, y, \lambda) = R_{pattern}(x,y) * \alpha(\lambda)
> $$
> 
> $$
> \alpha(\lambda)=\left\{\begin{array}{rcl}0.0001       &      & {\lambda  \in [400,700]}\\0.001exp({\dfrac{\lambda-700}{200}})     &      & {\lambda  \in [700,1300]}\\0.01exp({\dfrac{\lambda-1300}{300}})     &      & {\lambda  \in [1300,2500]}\end{array} \right. 
> $$
> 
> $R_{pattern}(x,y)$暂时考虑使用生成的均匀的雨噪声，$R_0$设置为1，700与1300为两个吸收峰，可以手动改变。
> 

---

> **雨雾信息**：
> 
> 
> $$
> I_F(x, y, \lambda) = I(x, y, \lambda)\cdot(1-F(x, y, \lambda)) + 
> F_0 \cdot F(x, y, \lambda)
> $$
> 
> 其中：
> 
> $$
> F(x, y, \lambda) = 1-e^{-\beta(\lambda) \cdot d}
> $$
> 
> $$
> β(λ)=β_0⋅(\frac{\lambda_0}{\lambda_i})^{k}
> $$
> 
> - $F_0$为大气光强，根据先验经验手动设置，k一般取瑞利散射的4，雨滴体积较大，其散射效应会均匀影响所有波段，因此不在这里体现。
> - $β_0$为手动设置的基波的散射系数

<aside>
💡

上述建模所做的假设：

1. 大气分布均匀
2. 水的厚度相同
</aside>